<#@ template debug="false" hostspecific="true" language="C#" #>
<#+ void AddM2MClasses(GenerationContext context){
var model = context.Model;
var settings = context.Settings;
var manager = context.Manager;
#>
<#+   
	if(!settings.PlaceContentsInSeparateFiles)
    {
		 manager.StartNewFile(model.Schema.ClassName + ".ContentsM2M"+".cs");
#>
// Code generated by a template
using System;
using System.Linq;
using System.Collections;
using System.Collections.Generic;

<#+
	}
	 #>
<#+  foreach(var content in model.Contents) { #>	
<#+	   	foreach(var attribute in content.Attributes.Where(x => x.IsM2M && x.IsSource == true)) { #>
<#+ 
			if(settings.PlaceContentsInSeparateFiles)
			{
				manager.StartNewFile(attribute.M2MClassName  + ".cs"); #>
// Code generated by a template
using System;
using System.Linq;
using System.Collections;
using System.Collections.Generic;

<#+
			}
#>
namespace <#=System.Runtime.Remoting.Messaging.CallContext.LogicalGetData("NamespaceHint")#>
{
    public partial class <#=attribute.M2MClassName#>: IQPLink
    {
		public <#=content.MappedName#> <#=attribute.M2MPropertyName#> { get; set; }		
		public <#=attribute.RelatedContent.MappedName#> <#=attribute.M2MRelatedPropertyName#> { get; set; }

		public int <#=attribute.M2MPropertyName#>Id { get; set; }	
		public int <#=attribute.M2MRelatedPropertyName#>Id { get; set; }

		public int LinkId
		{
			get { return <#=attribute.LinkId#>; }
		}

		public int Id 
		{ 
			get { return <#=attribute.M2MPropertyName#>Id; } 
			set { <#=attribute.M2MPropertyName#>Id = value; } 
		}
        public int LinkedItemId 
		{ 
			get { return <#=attribute.M2MRelatedPropertyName#>Id; }
			set { <#=attribute.M2MRelatedPropertyName#>Id = value; }
		}
		public IQPArticle Item { get { return <#=attribute.M2MPropertyName#>; } }		
		public IQPArticle LinkedItem { get { return <#=attribute.M2MRelatedPropertyName#>; } }
	}

<#+	 if(settings.UseReversedAssociations && attribute.RelatedContent.SplitArticles)
		{
#>
	public partial class <#=attribute.M2MReverseClassName#>: IQPLink
    {
		public <#=content.MappedName#> <#=attribute.M2MReversePropertyName#> { get; set; }		
		public <#=attribute.RelatedContent.MappedName#> <#=attribute.M2MReverseRelatedPropertyName#> { get; set; }

		public int <#=attribute.M2MReversePropertyName#>Id { get; set; }	
		public int <#=attribute.M2MReverseRelatedPropertyName#>Id { get; set; }

		public int LinkId
		{
			get { return <#=attribute.LinkId#>; }
		}

<#+  if(attribute.ContentId != attribute.RelatedContentId) { #>
                    
		public int Id 
		{ 
			get { return <#=attribute.M2MReversePropertyName#>Id; }
			set { <#=attribute.M2MReversePropertyName#>Id = value; }
		}
        public int LinkedItemId 
		{ 
			get { return <#=attribute.M2MReverseRelatedPropertyName#>Id; } 
			set { <#=attribute.M2MReverseRelatedPropertyName#>Id = value; }
		}
		public IQPArticle Item { get { return <#=attribute.M2MReversePropertyName#>; } }		
		public IQPArticle LinkedItem { get { return <#=attribute.M2MReverseRelatedPropertyName#>; } }
<#+ } else { #>
		public int Id 
		{ 
			get { return <#=attribute.M2MReverseRelatedPropertyName#>Id; } 
			set { <#=attribute.M2MReverseRelatedPropertyName#>Id = value; } 
		}
		public int LinkedItemId 
		{ 
			get { return <#=attribute.M2MReversePropertyName#>Id; } 
			set { <#=attribute.M2MReversePropertyName#>Id = value; } 
		}
		public IQPArticle Item { get { return <#=attribute.M2MReverseRelatedPropertyName#>; } }		
		public IQPArticle LinkedItem { get { return <#=attribute.M2MReversePropertyName#>; } }
<#+ } #>

	}

<#+     } #>
}
<#+}#>
<#+}#>
<#+}#>